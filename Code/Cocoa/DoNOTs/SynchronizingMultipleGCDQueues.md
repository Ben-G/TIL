Avoiding deadlocks when synchronizing with multiple GCD queues:

https://gist.github.com/jspahrsummers/dbd861d425d783bd2e5a